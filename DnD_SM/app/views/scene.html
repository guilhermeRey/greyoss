<style>
.slot {
  margin-right: 4px;
  margin-top: 4px;
  width: 40px;
  height: 40px;
  display: inline-block;
  border: none;
  background-color: rgba(255, 255, 255, 0.3);
}

.lvl-over {
  /* applied to a drop target when a draggable object is over it */
  border: 2px dashed black !important;
}

.lvl-target {
  /*
  applied to all drop targets when a drag operation begins
  removed when the drag operation ends
  used to indicate drop targets on a page
  */
  background-color: #ddd;
  opacity: .5;
}

[draggable] {
  /* not applied by the directive, but useful to indicate a draggable element */
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  cursor: move;
}
</style>

<div class="row wrapper border-bottom white-bg page-heading" ng-init="init()">
  <div class="col-lg-8">
    <h2>
      <i class="fa fa-bolt"></i>
      {{scene.name}} <br />
      <small><i class="fa fa-map-marker"></i> {{ scene.location.name }}</small>
    </h2>
    <p>{{scene.description}}</p>
    <h1>
      <span ng-show="isRolling">
        <i class="fa fa-cube fa-spin"></i>
        Rolando...
      </span>
      <span ng-show="!isRolling && rolls.length > 0">
        {{rolls[rolls.length - 1].text}} = <b>{{rolls[rolls.length - 1].result}}</b>
      </span>
    </h1>
    <audio style="display: none" src="dnd_resources/musics/rollingDice.mp3" id="dice-roll-sound">
    </audio>
  </div>
  <div class="col-lg-4" style="margin-top: 10px; text-align: center">
    <a ui-sref="index.scene({id: previous.id })" class="btn btn-block btn-outline btn-info" ng-show="previous.name != ''">
      <i class="fa fa-chevron-left"></i>
      <span>{{previous.name}}</span>
    </a>
    <a ui-sref="index.scene({id: next.id})" class="btn btn-block btn-outline btn-info" ng-show="next.name != ''">
      <i class="fa fa-chevron-right"></i>
      <span>{{next.name}}</span>
    </a>
    <div style="text-align: left; margin-top: 10px" ng-show="scene.musics && scene.musics.length > 0">
      <audio ng-src="{{scene.current.music.file}}" loop controls="controls" id="ambience-music" class="" style="width: 100%">
        <p>Seu nevegador não suporta o elemento audio.</p>
      </audio>
      <div class="dropdown">
        <button class="btn btn-warning dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
          <i class="fa fa-music"></i>
          {{scene.current.music.name}}
          <span class="caret"></span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
          <li ng-repeat="m in scene.musics">
            <a ng-click="music(m)">{{m.name}}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
<div class="row white-bg border-bottom">
  <div class="col-md-3">
    <div class="panel blank-panel">
      <div class="panel-heading">
        <div class="panel-options">
          <ul class="nav nav-tabs">
            <li ng-class="{'active':scene.current.menus.library.show}">
              <a ng-click="tab('library')">
                <i class="fa fa-book"></i>
              </a>
            </li>
            <li ng-class="{'active':scene.current.menus.combat.show}">
              <a ng-click="tab('combat')"><i class="fa fa-shield"></i></a></li>
              <li ng-class="{'active':scene.current.menus.tools.show}">
                <a ng-click="tab('tools')"><i class="fa fa-cube"></i></a></li>
            </ul>
          </div>
        </div>

        <div class="panel-body">
          <div class="tab-content">
            <div id="tab-4" ng-show="scene.current.menus.library.show">
              <div>
                <!-- MONSTERS -->
                <div>
                  <a class="btn btn-xs btn-outline btn-default pull-right" ng-click="toggleMenu(scene.current.menus.monsters)">
                    <i class="fa fa-eye"></i>
                  </a>
                  <h2>
                    <i class="fa fa-drupal"></i> Monstros
                  </h2>
                </div>
                <div class="scene-menus">
                  <table class="table" ng-show="scene.current.menus.monsters.show">
                    <tr ng-repeat="monster in scene.monsters">
                      <td colspan="">
                        <table class="table table-striped">
                          <tr>
                            <td class="client-avatar"><img ng-src="{{ monster.image }}" /></td>
                            <td style="vertical-align: middle">{{monster.name}}</td>
                            <td style="vertical-align: middle"><i class="fa fa-shield"></i> <br /> {{monster.ac}}</td>
                            <td style="vertical-align: middle"><i class="fa fa-heartbeat"></i> <br /> {{monster.hp}}</td>
                            <td style="vertical-align: middle"><i class="fa fa-cube"></i> <br /> +{{monster.initiative}}</td>
                            <td style="vertical-align: middle"><a class="btn btn-outline btn-info btn-xs" ng-click="addMonster(monster)">
                              <i class="fa fa-arrow-right"></i>
                            </a></td>
                          </tr>
                          <tr ng-repeat="spell in monster.spells">
                            <td style="text-align: center" colspan="2"><i class="fa fa-eye"></i> {{spell.name}}</td>
                            <td colspan="2" style="font-size: 0.95em;vertical-align:middle"><i class="fa fa-bolt"></i> {{spell.damage}}</td>
                            <td colspan="2">
                              <a class="btn btn-xs btn-outline btn-danger" title="Rolar Dano" ng-click="damageRoll(spell)">
                                <i class="fa fa-spinner"></i>
                              </a>
                              <a class="btn btn-xs btn-outline btn-warning" title="Rolar Dano" ng-click="initiativeRoll(monster.initiative)">
                                <i class="fa fa-warning"></i>
                              </a>
                            </td>
                          </tr>
                        </table>
                      </td>
                    </tr>
                  </table>
                </div>
                <!-- NPCS -->
                <div>
                  <a class="btn btn-xs btn-outline btn-default pull-right" ng-click="toggleMenu(scene.current.menus.npcs)">
                    <i class="fa fa-eye"></i>
                  </a>
                  <h2>
                    <i class="fa fa-users"></i> NPC's
                  </h2>
                </div>
                <table class="table" ng-show="scene.current.menus.npcs.show">
                  <tr ng-repeat="npc in scene.npcs">
                    <td colspan="">
                      <table class="table table-striped">
                        <tr>
                          <td class="client-avatar"><img ng-src="{{ npc.image }}" /></td>
                          <td style="vertical-align: middle">{{npc.name}}</td>
                          <td style="vertical-align: middle"><i class="fa fa-shield"></i> <br /> {{npc.ac}}</td>
                          <td style="vertical-align: middle"><i class="fa fa-heartbeat"></i> <br /> {{npc.hp}}</td>
                          <td style="vertical-align: middle"><i class="fa fa-cube"></i> <br /> +{{npc.initiative}}</td>
                          <td style="vertical-align: middle"><a class="btn btn-outline btn-info btn-xs" ng-click="addNPC(npc)">
                            <i class="fa fa-arrow-right"></i>
                          </a></td>
                        </tr>
                        <tr ng-repeat="hit in npc.hits">
                          <td style="text-align: center" colspan="2"><i class="fa fa-eye"></i> {{hit.name}}</td>
                          <td colspan="2" style="font-size: 0.95em;vertical-align:middle"><i class="fa fa-bolt"></i> {{hit.damage}}</td>
                          <td colspan="2">
                            <a class="btn btn-xs btn-outline btn-danger" title="Rolar Dano" ng-click="damageRoll(hit)">
                              <i class="fa fa-spinner"></i>
                            </a>
                            <a class="btn btn-xs btn-outline btn-warning" title="Rolar Dano" ng-click="initiativeRoll(npc.initiative)">
                              <i class="fa fa-warning"></i>
                            </a>
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              </div>
            </div>
            <div id="tab-5" ng-show="scene.current.menus.combat.show">
              <div>
                <a class="btn btn-outline btn-default" ng-click="refreshMonsters()" ng-show="scene.current.dungeon.monsters.length >= 0">
                  <i class="fa fa-eraser"></i> limpar
                </a>
                <a class="btn btn-outline btn-danger pull-right" ng-click="combat()" ng-show="scene.current.mode == 'normal'">
                  <i class="fa fa-gamepad"></i> combate
                </a>
                <a class="btn btn-outline btn-warning pull-right" ng-click="uncombat()" ng-show="scene.current.mode == 'combat'">
                  <i class="fa fa-remove"></i> normal
                </a>
                <br /><br />
                <div ng-show="scene.current.mode == 'combat'">
                  <form class="form-horizontal">
                    <div ng-repeat="init in scene.current.combat.initiative">
                      <div class="form-group">
                        <label class="col-lg-8 control-label">{{init.subject.name}}</label>
                        <div class="col-lg-4">
                          <input type="text" class="form-control" ng-model="init.initiative">
                        </div>
                      </div>
                    </div>
                  </form>
                  <a class="btn btn-outline btn-primary" ng-click="defineTurns()" ng-show="scene.current.mode == 'combat' && scene.current.combat.turns.length == 0">
                    <i class="fa fa-gears"></i> definir turnos
                  </a>
                  <div id="turns">
                    <div ng-repeat="sub in scene.current.combat.turns" ng-show="scene.current.combat.turns.length > 0">
                      <div class="widget style1" ng-class="{'navy-bg':sub.active}">
                        <div class="row vertical-align">
                          <div class="col-xs-3">
                            <i class="fa fa-user"></i>
                          </div>
                          <div class="col-xs-9 text-right">
                            <h3 class="font-bold">{{sub.subject.name}}</h3>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <a class="btn btn-block btn-outline btn-default" ng-click="nextTurn()" ng-show="scene.current.mode == 'combat' && scene.current.combat.turns.length > 0">
                    próximo <i class="fa fa-chevron-right"></i>
                  </a>
                </div>
                <div>
                  <br /><br />
                  <ul>
                    <li ng-repeat="monster in scene.current.dungeon.monsters">
                      <span class="btn btn-xs btn-warning"><i class="fa fa-heartbeat"></i> {{monster.hp}}</span>
                      <a class="btn btn-xs btn-danger" ng-click="hit(monster)"><i class="fa fa-gavel"></i> </a>
                      {{ monster.name }}
                    </li>
                  </ul>
                  <ul>
                    <li ng-repeat="npc in scene.current.dungeon.npcs">
                      <span class="btn btn-xs btn-warning">
                        <i class="fa fa-heartbeat"></i> {{npc.hp}}
                      </span>
                      <a class="btn btn-xs btn-danger" ng-click="hit(npc)"><i class="fa fa-gavel"></i> </a>
                      {{ npc.name }}
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div ng-show="scene.current.menus.tools.show">
              <div class="row vertical-align">
                <a ng-click="roll('1d20')" class="btn btn-outline btn-success">
                  1d20
                </a>
                <a ng-click="roll('1d10')" class="btn btn-outline btn-success">
                  1d10
                </a>
                <a ng-click="roll('1d4')" class="btn btn-outline btn-success">
                  1d4
                </a>
                <a ng-click="roll('1d12')" class="btn btn-outline btn-success">
                  1d12
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6" style="margin-bottom: 40px;">
      <div style="width:100%; height: 540px; text-align: center; background-image: url({{scene.location.map}});background-repeat: no-repeat" id="dungeon-grid" class="grid">
        <div draggable=true style="left:{{$index*60}}px;position: absolute; background: white; width: 60px; height: 60px; border: 2px solid #000" class="draggable" ng-repeat="player in main.game.players">
          <table style="width: 100%; height: 100%;">
            <tr>
              <td style="vertical-align: middle">
                <span><b>{{ player.name.substring(0, 13) }}</b></span>
              </td>
            </tr>
          </table>
        </div>
        <div ng-repeat="monster in scene.current.dungeon.monsters track by $index"
        ng-show="monster.hp > 0"
        draggable="true"
        style="position: absolute; background: black; color: white; width: 60px; height: 60px; border: 2px solid #F00" class="draggable">
        <span>{{ monster.name }}</span>
      </div>
      <div ng-repeat="npc in scene.current.dungeon.npcs track by $index"
      draggable="true"
      style="position: absolute; background: gray; color: white; width: 60px; height: 60px; border: 2px solid #F00" class="draggable">
      <span>{{ npc.name }}</span>
    </div>
  </div>
</div>
<div class="col-md-3">
  <div style="position: relative" id="grid-minimap">
    <img style="width:100%;" ng-src="{{ scene.location.map }}" id="grid-image-guide" />
    <div id="grid-square-guide" data-target-grid="dungeon-grid" class="draggable"
    style="position: absolute; height: 40px; width: 40px; border: 3px solid #F00; top: 0px; left: 0px">
    </div>
  </div>
  <input type="range" min="10" max="100" value="3" id="grid-slider-square-guide">
<div>

</div>
<div class="clearfix"></div>
<div>
  <h2 style="text-align: center"><i class="fa fa-gears"></i> Configurações</h2>
  <div>
  </div>
</div>
</div>
</div>
